<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contenido Protegido</title>
    <style>
        #protected-content {
            display: none; /* Oculto por defecto */
        }
    </style>
</head>
<body>
    <h1>Página Principal (Contenido Protegido)</h1>

    <div id="protected-content">
        <h2>¡Bienvenido, usuario autenticado!</h2>
        <p>Este es el contenido que solo los usuarios logueados pueden ver.</p>
        <button id="logout-btn">Cerrar Sesión</button>
    </div>

    <p id="login-redirect">Redirigiendo a la página de inicio de sesión...</p>

    <script type="module">
        // Importa las funciones de Firebase desde la CDN
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

        // Tu configuración de Firebase (reemplaza con tus valores)
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            databaseURL: "TU_DATABASE_URL",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const protectedContent = document.getElementById('protected-content');
        const loginRedirect = document.getElementById('login-redirect');
        const logoutBtn = document.getElementById('logout-btn');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuario autenticado
                protectedContent.style.display = 'block';
                loginRedirect.style.display = 'none';

                if (logoutBtn) {
                    logoutBtn.addEventListener('click', async () => {
                        try {
                            await signOut(auth);
                            console.log('Usuario cerró sesión');
                            // La redirección se manejará automáticamente por onAuthStateChanged
                        } catch (error) {
                            console.error('Error al cerrar sesión:', error);
                        }
                    });
                }
            } else {
                // Usuario no autenticado
                protectedContent.style.display = 'none';
                loginRedirect.style.display = 'block';
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>